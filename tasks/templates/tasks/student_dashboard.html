{% extends 'tasks/base.html' %}
{% block title %}Student Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">

  <!-- Header -->
  <div class="bg-primary text-white p-4 rounded-3 mb-4">
    <h2 class="mb-0">Welcome, {{ request.user.username }}</h2>
    <p class="mb-0">Your Task Overview</p>
  </div>

  <!-- Task Stats -->
  <div class="row text-center mb-4">
    <div class="col-md-2">
      <div class="card shadow-sm p-3 rounded-4">
        <h5 class="text-primary">Assigned</h5>
        <h3>{{ assigned_count }}</h3>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card shadow-sm p-3 rounded-4">
        <h5 class="text-warning">In Progress</h5>
        <h3>{{ in_progress_count }}</h3>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card shadow-sm p-3 rounded-4">
        <h5 class="text-success">Completed</h5>
        <h3>{{ completed_count }}</h3>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card shadow-sm p-3 rounded-4">
        <h5 class="text-danger">Pending</h5>
        <h3>{{ pending_count }}</h3>
      </div>
    </div>
    <div class="col-md-2">
      <div class="card shadow-sm p-3 rounded-4">
        <h5 class="text-dark">Total</h5>
        <h3>{{ total_count }}</h3>
      </div>
    </div>
  </div>

  <!-- Task Table -->
  <div class="card shadow-lg rounded-4 mb-4">
    <div class="card-body">
      <h4 class="text-center text-primary mb-4">Your Tasks</h4>
      {% if tasks %}
      <table class="table table-bordered table-hover">
        <thead class="table-primary">
          <tr>
            <th>Title</th>
            <th>Status</th>
            <th>Due Date</th>
            <th>Attachment</th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.due_date|date:"Y-m-d" }}</td>
            <td>
              {% if task.attachment %}
                <a href="{{ task.attachment.url }}" target="_blank">View</a>
              {% else %}
                -
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center text-muted">No tasks assigned yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Notes Section -->
  <div class="card shadow-lg rounded-4">
    <div class="card-body">
      <h4 class="text-center text-success mb-4">Teacher Notes</h4>
      {% if notes %}
      <table class="table table-striped table-hover">
        <thead class="table-success">
          <tr>
            <th>File Name</th>
            <th>Uploaded By</th>
            <th>Uploaded At</th>
            <th>Download</th>
          </tr>
        </thead>
        <tbody>
          {% for note in notes %}
          <tr>
            <td>{{ note.file.name|cut:"notes/" }}</td>
            <td>{{ note.uploaded_by.username }}</td>
            <td>{{ note.uploaded_at|date:"Y-m-d H:i" }}</td>
            <td>
              <a href="{{ note.file.url }}" class="btn btn-outline-primary btn-sm" download>
                Download
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center text-muted">No notes uploaded yet.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
